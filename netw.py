#!/usr/bin/python

###Yeudiel Hernandez Torres
###PBSI - 11G
###Escaner de red ICMP/ARP

from scapy.all import *
import netaddr, sys

if len(sys.argv) != 3:
	print "uso: netw <red/prefijo> <protocolo>.\nEjemplo: netw 192.168.1.0/24 -a | netw 192.168.1.0/24 -i " 
	exit(1)

network = sys.argv[1]

if sys.argv[2] == "-i":
	print "ICMP"


	# lista de direcciones y contador de host en linea
	addresses = netaddr.IPNetwork(network)
	online = 0
	
	# Envia ping ICMP esperando respuesta
	for host in addresses:
		if (host == addresses.network or host == addresses.broadcast):
			continue
		resp = sr1(IP(dst=str(host))/ICMP(),timeout=1,verbose=False)
		if (str(type(resp)) == "<type 'NoneType'>"):
			print str(host) + " Sin respuesta."
		elif (int(resp.getlayer(ICMP).type)==3 and int(resp.getlayer(ICMP).code) in [1,2,3,9,10,13]):
		        print str(host) + " Bloqueando ICMP."
		else:
			print str(host) + " Respondiendo."
			online += 1

elif sys.argv[2] == "-a":
	print "ARP"
	ans,unans=srp(Ether(dst="ff:ff:ff:ff:ff:ff")/ARP(pdst=network),timeout=2,verbose=0)
	ans.summary(lambda (s,r): r.sprintf("%Ether.src% %ARP.psrc%") )

else: 
	print "Opcion Invalida"

